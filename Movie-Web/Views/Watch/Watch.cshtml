
@{
    ViewBag.Title = "Watch";
    Layout = "~/Views/Shared/_Layout.cshtml";
    var user = Session["USER_SESSION"] as Movie_Web.Common.UserSession;
}
<section class="section player-section">
    <div class="section__background"></div>
    <div class="body-container">
        <div class="grid wide">
            <div class="grid">
                <div class="container__watch row">
                    <div class="col c-12">
                        <div class="container__player">
                            <video class="container__player-video"
                                   src="@ViewBag.filmDetail.linkEpisode"
                                   type="video/mp4"
                                   controls autoplay></video>
                        </div>
                        <div class="player_message">
                            Mẹo tìm kiếm phim trên Google: "Tên phim + movieweb"
                            <br />
                            <div class="message--warning">
                                Hãy đăng nhập tài khoản để loại bỏ quảng cáo!!!
                            </div>
                        </div>
                        <div class="bar-player">
                            <ul class="bar-left">
                                <li class="report">
                                    <a href="#" class="report__link">
                                        <i class="fas fa-exclamation-triangle"></i>
                                        Báo lỗi
                                    </a>
                                </li>
                                <li id="toggle-light">
                                    <a href="#">
                                        <i class="fas fa-lightbulb"></i>
                                        Tắt đèn
                                    </a>
                                </li>
                                <li class="close-qc">
                                    <a href="">
                                        <i class="fas fa-window-close"></i>
                                        Tắt quảng cáo
                                    </a>
                                </li>
                                <li class="embedded">
                                    <a href="#" class="embedded-link">
                                        <i class="fas fa-code"></i>
                                        Embedded
                                    </a>
                                </li>
                            </ul>
                        </div>
                        <div class="film-title">
                            <div class="film-title__left">
                                <h2 class="player-title">
                                    <i class="fas fa-play-circle"></i>
                                    @ViewBag.filmDetail.nameFilm

                                    @if (@ViewBag.filmDetail.totalEpisodes == 1)
                                    {
                                        <span></span>
                                    }
                                    else
                                    {
                                        <span>
                                            Tập @ViewBag.filmDetail.Episode
                                        </span>
                                    } [Vietsub]
                                </h2>
                                <span class="player-sub-title">
                                    @ViewBag.filmDetail.nameEngFilm
                                </span>
                                <div class="social-media">
                                    <a href="" class="social-media__like">
                                        <i class="fas fa-thumbs-up"></i>
                                        Thích
                                    </a>
                                    <a href="" class="social-media__share"> Chia sẻ </a>
                                </div>
                            </div>
                            <div class="film-title__right">
                                <div class="rating-content">
                                    <div id="rating">
                                        <ul class="rate-area">
                                            <input type="radio"
                                                   id="5-star"
                                                   name="crating"
                                                   value="5" />
                                            <label for="5-star" title="Amazing">5 stars</label>
                                            <input type="radio"
                                                   id="4-star"
                                                   name="crating"
                                                   value="4" />
                                            <label for="4-star" title="Good">4 stars</label>
                                            <input type="radio"
                                                   id="3-star"
                                                   name="crating"
                                                   value="3" />
                                            <label for="3-star" title="Average">3 stars</label>
                                            <input type="radio"
                                                   id="2-star"
                                                   name="crating"
                                                   value="2" />
                                            <label for="2-star" title="Not Good">2 stars</label>
                                            <input type="radio"
                                                   id="1-star"
                                                   required=""
                                                   name="crating"
                                                   value="1"
                                                   aria-required="true" />
                                            <label for="1-star" title="Bad">1 star</label>
                                        </ul>
                                    </div>
                                    <i id="score-rating">
                                        ( <span id="rating_score">3.7</span><i class="fas fa-star star-icon"></i> /
                                        <span id="total_rating">52</span> lượt )
                                    </i>
                                </div>
                            </div>
                        </div>
                        <div class="film-episodes">
                            <div class="server-name">
                                <i class="fas fa-list"></i>
                                Vietsub
                            </div>
                            <div class="list-episodes">
                                <div class="list-episodes__title"></div>
                                <div class="list-episodes__content">
                                    <div class="grid">
                                        <div class="row margin-0 episode_row">
                                            @for (int index = 1; index <= @ViewBag.filmDetail.releasedEpisodes; index++)
                                            {
                                                <div class="episodes col c-2">
                                                    <a href="/Watch/Watch/@ViewBag.filmDetail.filmID.Trim()/@index.ToString()" class="episodes-link">
                                                        Tập @index.ToString()
                                                    </a>
                                                </div>
                                            }


                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div id="lightout" class=""></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>
<section class="comment-section">
    <div class="comment-section__container">
        <div class="grid wide">
            <div class="row">
                <div class="c-12">
                    <ul class="breadcumb">
                        <li class="breadcumb__item">
                            <a href="#">Trang chủ <i class="fas fa-arrow-right"></i></a>
                        </li>
                        <li class="breadcumb__item">
                            <a href="#">
                                @if (@ViewBag.filmDetail.totalEpisodes == 1)
                                {
                                    <span>Phim lẻ</span>
                                }
                                else
                                {
                                    <span>
                                        Phim bộ
                                    </span>
                                } <i class="fas fa-arrow-right"></i>
                            </a>

                        </li>
                        <li class="breadcumb__item">
                            <a href="#">
                                @ViewBag.filmDetail.nameFilm

                            </a>
                        </li>
                        <li class="breadcumb__item">
                            <a href="#">
                                @if (@ViewBag.filmDetail.totalEpisodes == 1)
                                {
                                    <span></span>
                                }
                                else
                                {
                                    <i class="fas fa-arrow-right"></i>
                                    <span>
                                        Tập @ViewBag.filmDetail.Episode
                                    </span>
                                }
                            </a>
                        </li>
                    </ul>
                </div>
                <div class="col c-12">
                    <div class="row">
                        <div class="col c-9">
                            <h1 class="comment-section__title">
                                <a href="">
                                    <br />
                                    @ViewBag.filmDetail.nameFilm <br /><br />
                                    @ViewBag.filmDetail.nameEngFilm
                                </a>
                            </h1>
                            <div class="comment-section__subtitle">
                                <h2>
                                    @ViewBag.filmDetail.nameFilm - @ViewBag.filmDetail.nameEngFilm
                                </h2>
                                <p>
                                    @ViewBag.filmDetail.contentText
                                </p>
                            </div>
                            <div class="comment-section__content">
                                <div id="fb-root"></div>
                                <script async
                                        defer
                                        crossorigin="anonymous"
                                        src="https://connect.facebook.net/vi_VN/sdk.js#xfbml=1&version=v10.0"
                                        nonce="b1Jr6G1A"></script>
                                <div class="fb-comments"
                                     data-href="https://developers.facebook.com/docs/plugins/comments#configurator"
                                     data-width="918"
                                     style="background-color: white"
                                     data-numposts="5"></div>
                            </div>
                        </div>
                        <div class="col c-3">
                            <div class="tab-title">
                                <h2>Nổi bật</h2>
                            </div>
                            <div class="tab-content">
                                @foreach (var itemFilm in ViewBag.listfilmDescendingbyCreateDate)
                                {
                                    <div class="row">
                                        <div class="c-3">
                                            <div class="card__cover">
                                                <img src="@itemFilm.linkImgAvt"
                                                     alt="@itemFilm.nameFilm - @itemFilm.nameEngFilm"
                                                     class="card__img" />
                                                <a href="/DetailFilm/Detail/@itemFilm.filmID" class="card__play card__play--">
                                                    <i class="card__play-icon card__play-icon--small fas fa-play"></i>
                                                </a>
                                            </div>
                                        </div>
                                        <div class="c-9">
                                            <div class="card__content">
                                                <a href="/DetailFilm/Detail/@ViewBag.filmDetail.filmID" title="@itemFilm.nameFilm">
                                                    <p class="movie-title">@itemFilm.nameFilm</p>
                                                    <span class="original-title">@itemFilm.nameEngFilm</span>
                                                    <div class="view-count">IMDb @itemFilm.imdb</div>
                                                </a>
                                            </div>
                                        </div>
                                    </div>
                                }
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<section class="comment-form-section">
    <div class="form__head">
        <div class="grid wide">
            <div class="row">
                <div class="col c-12">
                    <h3 class="form__title">Hãy đánh giá phim ở đây nhé !</h3>
                    <ul class="form__navbar">
                        <li class="form__navbar-item">
                            <a href="" class="form__navbar-link active">Binh luan</a>
                        </li>
                        <li class="form__navbar-item">
                            <a href="" class="form__navbar-link">Review</a>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
    <div class="form__body">
        <div class="grid wide">
            <div class="row">
                <div class="col l-8">
                    <div class="grid">
                        <div class="row">
                            <div class="col l-12">
                                <div class="tab-content" id="myTabContent">
                                    <div class="tab-pane fade show active" id="tab-1" role="tabpanel" aria-labelledby="1-tab">

                                        <div class="col l-12">
                                            <div class="comments">

                                                <div id="comment-form">
                                                    <form action="/DetailFilm/addCmt" class="form form-comment" method="post">
                                                        <div class="content-quote"></div>

                                                        @if (user == null)
                                                        {

                                                        }
                                                        else
                                                        {
                                                            <input type="hidden" name="accountID" value="@user.AccountID">
                                                        }
                                                        <input type="hidden" name="filmID" value="@ViewBag.filmDetail.filmID">
                                                        <input type="hidden" name="backUrl" value="@Context.Request.Path">

                                                        <textarea name="cmt" required="" class="form__textarea" placeholder="Để lại bình luận của bạn"></textarea>

                                                        <button type="submit" class="form__btn">Gửi</button>
                                                    </form>
                                                </div>



                                                <div class="comment-content">
                                                    <div class="comments__list" id="comment-content">
                                                        @foreach (var item in ViewBag.FeedBackOfAcc)
                                                        {
                                                            <div class="comment" id="comment-32512">
                                                                <div class="comments__item">
                                                                    <div class="comments__autor">
                                                                        <a>
                                                                            <img class="comments__avatar" src="https://lh3.googleusercontent.com/a-/AOh14GgFqN_enMc41tuvAe1KSCsl1pJA4k3nwR0q38Xh=s96-c" alt="Maria sajah">
                                                                            <span class="comments__name">@item.username</span>
                                                                        </a>
                                                                        <span class="comments__time">@item.sentDate</span>
                                                                    </div>
                                                                    <div class="comments__text">
                                                                        <div class="content_of_comment">
                                                                            @item.cmt
                                                                        </div>
                                                                    </div>
                                                                </div>


                                                            </div>
                                                        }




                                                    </div>
                                                    <div class="see-more-comments"></div>
                                                </div>


                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>



                    </div>
                </div>
                <div class="col c-4">
                    <div class="row">
                        <div class="col c-12">
                            <h3 class="suggestion-section__title">Có thể bạn thích...</h3>
                        </div>
                        @foreach (var itemFilm in ViewBag.listfilmDescendingbyCreateDate)
                        {
                            <div class="col c-6">
                                <div class="card">
                                    <div class="card__cover">
                                        <img src="@itemFilm.linkImgAvt"
                                             alt="@itemFilm.nameFilm - @itemFilm.nameEngFilm" />
                                        <a href="/DetailFilm/Detail/@itemFilm.filmID" class="card__play card__play--">
                                            <i class="card__play-icon card__play-icon--small fas fa-play"></i>
                                        </a>
                                    </div>
                                    <div class="card__content">
                                        <h5 class="card__title">
                                            <a href="/DetailFilm/Detail/@ViewBag.filmDetail.filmID"
                                               title="@itemFilm.nameFilm">@itemFilm.nameFilm</a>
                                        </h5>

                                        <span class="title_origin">@itemFilm.nameEngFilm</span>
                                    </div>
                                </div>
                            </div>
                        }
                    </div>
                </div>
                <div class="col c-12"></div>
            </div>
        </div>
    </div>
</section>

<script>
      var toggleLight = document.getElementById("toggle-light");
      toggleLight.onclick = function () {
        var light = document.getElementById("lightout");
        var barPlayer = document.querySelector(".bar-player");
        var containerPlayer = document.querySelector(".container__player");
        var bulb = document.querySelector("#toggle-light a");
        if (light.classList.contains("light")) {
          containerPlayer.classList.remove("light");
          barPlayer.classList.remove("light");
          light.classList.remove("light");
          bulb.innerHTML = ` <i class="fas fa-lightbulb"></i>
                        Tắt đèn`;
        } else {
          containerPlayer.classList.add("light");
          barPlayer.classList.add("light");
          light.classList.add("light");
          bulb.innerHTML = ` <i class="far fa-lightbulb"></i>
                        Bật đèn`;
        }
    };

    const ep = 'Tập ' + @ViewBag.filmDetail.Episode;

    for (const a of document.querySelectorAll("a")) {
        let text = a.textContent.trim()
        if (text === ep ){
            a.classList.add("active")
        }
    }
</script>

